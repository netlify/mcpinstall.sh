---
export const prerender = false;

import Layout from "../../layouts/Layout.astro";
import { generateGenericConfig } from "../../utils/configs";
import { getClientById } from "../../utils/clientData";
import { marked } from "marked";

const { encodeddata, clientId } = Astro.params;
const decodedData = encodeddata && JSON.parse(atob(decodeURIComponent(encodeddata)));

const mcpServerName = decodedData?.name ? `"${decodedData.name}" MCP Server` : "MCP Server";
const client = getClientById(clientId as string);

if (!client) {
  return Astro.redirect(`/${encodeddata}`);
}

const clientSpecificConfig = client.generateConfig(decodedData);
const instructionsMarkdown = client.instructions(client.generateConfig, decodedData);
const instructionsHtml = marked(instructionsMarkdown);
---

<Layout />
<main class="min-h-screen flex bg-[#fdf6e3]">
  <!-- Left side: Clean minimal MCP server info -->
  <div class="w-2/5 bg-[#fdf6e3] border-r border-[#e0ddd4] flex flex-col px-12 py-16">
    <!-- Back link at top left -->
    <div class="mb-6 -mt-12">
      <a 
        href={`/${encodeddata}`}
        class="text-[#006f92] hover:text-[#1a2946] transition-colors duration-200"
      >
        ← Back
      </a>
    </div>

    <div class="max-w-md flex-1 flex flex-col mt-[40%]">
      <!-- MCP Server Header -->
      <div class="mb-8">
        <h1 class="text-4xl font-bold text-[#1a2946] mb-4">
          {decodedData?.name || 'MCP Server'}
        </h1>
        <p class="text-lg text-gray-600 leading-relaxed">
          {decodedData?.desc || 'No server description provided'}
        </p>
      </div>

      <!-- Clean MCP Server Details -->
      <div class="space-y-6">
        {decodedData?.homepage && (
          <div>
            <h3 class="text-sm font-semibold text-[#1a2946] uppercase tracking-wide mb-2">Homepage</h3>
            <a 
              href={decodedData.homepage} 
              target="_blank" 
              rel="noopener noreferrer"
              class="text-[#006f92] hover:text-[#1a2946] transition-colors"
            >
              Visit homepage →
            </a>
          </div>
        )}

        {decodedData?.repository && (
          <div>
            <h3 class="text-sm font-semibold text-[#1a2946] uppercase tracking-wide mb-2">Source Code</h3>
            <a 
              href={decodedData.repository} 
              target="_blank" 
              rel="noopener noreferrer"
              class="text-[#006f92] hover:text-[#1a2946] transition-colors"
            >
              View repository →
            </a>
          </div>
        )}
      </div>
    </div>
  </div>

  <!-- Right side: Installation form/instructions -->
  <div class="flex-1 bg-white shadow-xl">
    <div class="px-12 py-16 max-w-3xl">

      <!-- Installation Header -->
      <div class="mb-8">
        <div class="flex items-center gap-3 mb-4">
          <img src={client.imageUrl} alt={`${client.name} icon`} class="w-6 h-6 object-contain" />
          <h2 class="text-3xl text-gray-700 font-bold">{client.name} MCP Server Installation</h2>
        </div>
        <p class="text-gray-600">
          Follow these steps to install this MCP server in {client.name}
        </p>
      </div>

      <!-- Installation Steps -->
      <div class="bg-[#fffefc] rounded-lg mb-8">
        <div class="prose max-w-none 
                    prose-headings:text-[#1a2946] prose-headings:font-bold
                    prose-h1:text-2xl prose-h1:mb-6 prose-h1:mt-0
                    prose-h2:text-xl prose-h2:mb-4 prose-h2:mt-0
                    prose-p:text-gray-700 prose-p:leading-relaxed
                    prose-strong:text-[#1a2946] prose-strong:font-semibold
                    prose-ol:space-y-3 prose-li:text-gray-700
                    prose-inline-code:bg-[#eee8d5] prose-inline-code:text-[#1a2946] prose-inline-code:px-2 prose-inline-code:py-1 prose-inline-code:rounded prose-inline-code:text-sm prose-inline-code:font-mono
                    prose-pre:bg-[#1a2946] prose-pre:text-[#fdf6e3] prose-pre:p-4 prose-pre:rounded-lg prose-pre:overflow-auto prose-pre:leading-tight
                    prose-code:bg-purple prose-pre:code:!p-0 prose-pre:code:!text-[#fdf6e3] prose-pre:code:!leading-tight
                    prose-blockquote:border-l-4 prose-blockquote:border-[#006f92] prose-blockquote:bg-[#eee8d5] prose-blockquote:p-4 prose-blockquote:rounded-r-lg prose-blockquote:my-4
                    prose-blockquote:text-[#1a2946] prose-blockquote:font-medium prose-blockquote:italic-0">
          <div set:html={instructionsHtml}></div>
        </div>
      </div>

      <!-- Client Resources -->
      {client.docs && (
        <div class="bg-[#f8f9fa] border border-[#e9ecef] rounded-lg p-6">
          <h3 class="font-semibold mb-3 flex items-center gap-2">
            <img src={client.imageUrl} alt={`${client.name} icon`} class="w-5 h-5 object-contain" />
            Need more help with {client.name}?
          </h3>
          <p class="text-gray-600 mb-4">
            Check the official documentation for detailed MCP setup instructions:
          </p>
          <a 
            href={client.docs} 
            target="_blank" 
            rel="noopener noreferrer"
            class="text-[#006f92] hover:text-[#1a2946] transition-colors duration-200"
          >
            View {client.name} MCP Documentation →
          </a>
        </div>
      )}

    </div>
  </div>
</main>

