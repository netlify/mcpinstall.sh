---
export const prerender = false;

import Layout from "../../layouts/Layout.astro";
import { generateGenericConfig } from "../../utils/configs";
import { getClientById } from "../../utils/clientData";
import { marked } from "marked";

const { encodeddata, clientId } = Astro.params;
const decodedData = encodeddata && JSON.parse(atob(decodeURIComponent(encodeddata)));

const mcpServerName = decodedData?.name ? `"${decodedData.name}" MCP server` : "MCP server";
const client = getClientById(clientId as string);

if (!client) {
  return Astro.redirect(`/${encodeddata}`);
}

const clientSpecificConfig = client.generateConfig(decodedData);
const instructionsMarkdown = client.instructions(client.generateConfig, decodedData);
const instructionsHtml = marked(instructionsMarkdown);
---

<Layout />
<main class="min-h-screen flex flex-col bg-[#fdf6e3] text-navy font-sans py-8">
  <!-- Header with back button -->
  <div class="w-full max-w-6xl mx-auto px-4 mb-8">
    
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-4">
        <h1 class="text-3xl font-bold flex items-center gap-6">
          <span>Installing {mcpServerName} on</span>
          <div class="flex items-center gap-3">
            <img src={client.imageUrl} alt={`${client.name} icon`} class="w-8 h-8 object-contain" />
            <span>{client.name}</span>
          </div>
        </h1>
      </div>
      <a 
        href={`/${encodeddata}`}
        class="text-md text-gray-500 hover:text-[#006f92] transition-colors duration-200 underline decoration-dotted underline-offset-4"
      >
        Using a different MCP client?
      </a>
    </div>

  </div>
  
  <div class="w-full max-w-6xl mx-auto flex flex-col lg:flex-row gap-12 px-4">
    <!-- column: Resources -->
    <div class="flex-1">
      
      <!-- MCP Server Resources -->
      <div class="mb-8">
        
        <div class="mb-8">
          <h2 class="text-2xl font-bold mb-2">
            {mcpServerName} details
          </h2>

          <p>
            Follow these steps to install this MCP server in {client.name}:
          </p>
          
        </div>
        <div class="bg-white border border-[#eee8d5] rounded-lg p-4">
          <h4 class="font-semibold mb-2">Description</h4>
          <p>{decodedData?.desc || 'No server description provided'}</p>
        </div>
      </div>

      <!-- Client Resources -->
      <div class="mt-20">

        <h3 class="text-2xl font-semibold mb-2 flex items-center gap-2">
          <img src={client.imageUrl} alt={`${client.name} icon`} class="w-5 h-5 object-contain" />
          {client.name} resources
        </h3>

        <div class="bg-white border border-[#eee8d5] rounded-lg p-4">
          
          <p class="text-sm mb-3">Learn more about using MCP servers with {client.name}:</p>
          <a 
            href={client.docs} 
            target="_blank" 
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 text-[#006f92] hover:text-[#1a2946] transition-colors duration-200"
          >
            <span>View {client.name} MCP Documentation</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4">
              <path d="M7 17L17 7"/>
              <path d="M7 7h10v10"/>
            </svg>
          </a>
        </div>
      </div>
    </div>
    
    <!-- column: Instructions -->
    <div class="flex-1">

      <div class="mb-8">
        <h2 class="text-2xl font-bold mb-2">
          How to manually install
        </h2>

        <p>
          Follow these steps to install this MCP server in {client.name}:
        </p>
        
      </div>

      <div class="bg-[#fffefc] border border-[#e0ddd4] rounded-lg p-6 mb-6">
        <div class="prose max-w-none 
                    prose-headings:text-[#1a2946] prose-headings:font-bold
                    prose-h1:text-2xl prose-h1:mb-6 prose-h1:mt-0
                    prose-h2:text-xl prose-h2:mb-4 prose-h2:mt-0
                    prose-p:text-gray-700 prose-p:leading-relaxed
                    prose-strong:text-[#1a2946] prose-strong:font-semibold
                    prose-ol:space-y-3 prose-li:text-gray-700
                    prose-inline-code:bg-[#eee8d5] prose-inline-code:text-[#1a2946] prose-inline-code:px-2 prose-inline-code:py-1 prose-inline-code:rounded prose-inline-code:text-sm prose-inline-code:font-mono
                    prose-pre:bg-[#1a2946] prose-pre:text-[#fdf6e3] prose-pre:p-4 prose-pre:rounded-lg prose-pre:overflow-auto prose-pre:leading-tight
                    prose-code:bg-purple prose-pre:code:!p-0 prose-pre:code:!text-[#fdf6e3] prose-pre:code:!leading-tight
                    prose-blockquote:border-l-4 prose-blockquote:border-[#006f92] prose-blockquote:bg-[#eee8d5] prose-blockquote:p-4 prose-blockquote:rounded-r-lg prose-blockquote:my-4
                    prose-blockquote:text-[#1a2946] prose-blockquote:font-medium prose-blockquote:italic-0">
          <div set:html={instructionsHtml}></div>
        </div>
      </div>
      
    </div>

    
  </div>
</main>

