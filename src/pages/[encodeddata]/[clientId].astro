---
export const prerender = false;

import Layout from "../../layouts/Layout.astro";
import McpServerDetails from "../../components/McpServerDetails.astro";
import PageHeader from "../../components/PageHeader.astro";
import { generateGenericConfig } from "../../utils/configs";
import { getClientById } from "../../utils/clientData";
import { marked } from "marked";

const { encodeddata, clientId } = Astro.params;
const decodedData = encodeddata && JSON.parse(atob(decodeURIComponent(encodeddata)));

const mcpServerName = decodedData?.name ? `"${decodedData.name}" MCP Server` : "MCP Server";
const client = getClientById(clientId as string);

if (!client) {
  return Astro.redirect(`/${encodeddata}`);
}

const clientSpecificConfig = client.generateConfig(decodedData);
const instructionsMarkdown = client.instructions(client.generateConfig, decodedData);
const instructionsHtml = marked(instructionsMarkdown);

// Generate install link if the client supports it
const installLinkData = client.generateInstallLink ? client.generateInstallLink(decodedData) : null;
---

<Layout />
<main class="min-h-screen flex flex-col lg:flex-row bg-[#fdf6e3]">
  <!-- Left side: Clean minimal MCP server info -->
  <div class="w-full lg:w-2/5 bg-[#fdf6e3] border-b lg:border-b-0 lg:border-r border-[#e0ddd4] flex flex-col px-6 lg:px-12 py-8 lg:py-16">
    <PageHeader rightLinks={[
      { url: `/${encodeddata}`, text: "← Choose a different MCP client" }
    ]} />

    <div class="max-w-md flex-1 flex flex-col lg:mt-[20%] xl:mt-[15%] 2xl:mt-32">
      <McpServerDetails decodedData={decodedData} />
    </div>
  </div>

  <!-- Right side: Installation form/instructions -->
  <div class="flex-1 bg-white shadow-xl">
    <div class="px-6 lg:px-12 py-8 lg:py-16 max-w-3xl">

      <!-- Installation Header -->
      <div class="mb-8">
        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 mb-4">
          <img src={client.imageUrl} alt={`${client.name} icon`} class="w-6 h-6 object-contain" />
          <h2 class="text-2xl lg:text-3xl text-gray-700 font-bold">{client.name} with MCP Installation</h2>
        </div>
      </div>

      <!-- One-Click Install Link (if available) -->
      {installLinkData && (
        <div class="mb-12 border-b border-[#e0ddd4]">
          <div class="bg-gradient-to-r from-[#006f92] to-[#1a2946] rounded-lg p-6 mb-12 text-white">
            <div class="flex items-center gap-3 mb-4">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
              </svg>
              <h3 class="text-xl font-bold">One-Click Install</h3>
            </div>
            <p class="mb-4 text-blue-100">
              This link will automatically install the {mcpServerName} in {client.name}:
            </p>
            <a 
              href={installLinkData.installLink}
              class="inline-flex items-center gap-2 bg-white text-[#006f92] font-semibold px-6 py-3 rounded-lg hover:bg-gray-100 transition-colors duration-200"
            >
              <img src={client.imageUrl} alt={`${client.name} icon`} class="w-5 h-5 object-contain" />
              Install in {client.name}
            </a>
            <p class="mt-12 text-sm text-blue-100">
              <b>What to expect?</b> If you have {client.name} installed, this link will open {client.name} and prompt you to install the MCP server automatically. The same configuration seen in the manual section below will be applied. You can adjust these settings after install.
            </p>
          </div>
        </div>
        
      )}

      <!-- Installation Steps -->
      <div class="bg-[#fffefc] rounded-lg mb-8">

        <div class="pb-12">
          <h2 class="text-3xl font-semibold text-[#1a2946] pb-2">
            Installation Instructions
          </h2>

          <p class="text-gray-600">
            Follow these steps to install this MCP server in {client.name}
          </p>
        </div>
       

        <div class="prose max-w-none 
                    prose-headings:text-[#1a2946] prose-headings:font-bold
                    prose-h1:text-2xl prose-h1:mb-6 prose-h1:mt-0
                    prose-h2:text-xl prose-h2:mb-4 prose-h2:mt-0
                    prose-p:text-gray-700 prose-p:leading-relaxed
                    prose-strong:text-[#1a2946] prose-strong:font-semibold
                    prose-ol:space-y-3 prose-li:text-gray-700
                    prose-inline-code:bg-[#eee8d5] prose-inline-code:text-[#1a2946] prose-inline-code:px-2 prose-inline-code:py-1 prose-inline-code:rounded prose-inline-code:text-sm prose-inline-code:font-mono
                    prose-pre:bg-[#1a2946] prose-pre:text-[#fdf6e3] prose-pre:p-4 prose-pre:rounded-lg prose-pre:overflow-auto prose-pre:leading-tight
                    prose-code:bg-purple prose-pre:code:!p-0 prose-pre:code:!text-[#fdf6e3] prose-pre:code:!leading-tight
                    prose-blockquote:border-l-4 prose-blockquote:border-[#006f92] prose-blockquote:bg-[#eee8d5] prose-blockquote:p-4 prose-blockquote:rounded-r-lg prose-blockquote:my-4
                    prose-blockquote:text-[#1a2946] prose-blockquote:font-medium prose-blockquote:italic-0">
          <div set:html={instructionsHtml}></div>
        </div>
      </div>

      <!-- Client Resources -->
      {client.docs && (
        <div class="bg-[#f8f9fa] border border-[#e9ecef] rounded-lg p-6">
          <h3 class="font-semibold mb-3 flex items-center gap-2">
            <img src={client.imageUrl} alt={`${client.name} icon`} class="w-5 h-5 object-contain" />
            Need more help with {client.name}?
          </h3>
          <p class="text-gray-600 mb-4">
            Check the official documentation for detailed MCP setup instructions:
          </p>
          <a 
            href={client.docs} 
            target="_blank" 
            rel="noopener noreferrer"
            class="text-[#006f92] hover:text-[#1a2946] transition-colors duration-200"
          >
            View {client.name} MCP Documentation →
          </a>
        </div>
      )}

    </div>
  </div>
</main>

<script src="/scripts/mcp-copy-buttons.js"  is:inline></script>

